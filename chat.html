<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Ajax</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #F7F7F7;
		}
		
		h3 {
			text-align: center;
		}

		.chatbox {
			width: 500px;
			height: 500px;
			margin: 0 auto;
			border: 1px solid #CCC;
			background-color: #FFF;
			border-radius: 5px;
		}

		.messages {
			height: 350px;
			padding: 20px 40px;
			box-sizing: border-box;
			border-bottom: 1px solid #CCC;
			overflow: scroll;
		}

		.messages h5 {
			font-size: 20px;
			margin: 10px 0;
		}

		.messages p {
			font-size: 18px;
			margin: 0;
		}

		.self {
			text-align: left;
		}

		.other {
			text-align: right;
		}

		.form {
			height: 150px;
		}

		.form .input {
			height: 110px;
			padding: 10px;
			box-sizing: border-box;
		}

		.form .btn {
			height: 40px;
			box-sizing: border-box;
			border-top: 1px solid #CCC;
		}

		.form textarea {
			display: block;
			width: 100%;
			height: 100%;
			box-sizing: border-box;
			border: none;
			resize: none;
			outline: none;
			font-size: 20px;
		}

		.form input {
			display: block;
			width: 100px;
			height: 30px;
			margin-top: 5px;
			margin-right: 20px;
			float: right;
		}
	</style>
</head>
<body>
	<h3>简单的Ajax实例</h3>

	<div class="chatbox">
		<!-- 聊天内容 -->
		<div class="messages">		


		</div>

		<!-- 表单 -->
		<div class="form">
			<!-- 输入框 -->
			<div class="input">
				<textarea></textarea>
			</div>
			<!-- 按钮 -->
			<div class="btn">
				<input type="button" value="发送">
			</div>
		</div>
	</div>

	<!-- 直接忽略 春哥说的 -->
	<script type="text/template">

		<div class="self">
			<h5>我说</h5>
			<p>你好</p>
		</div>

		<div class="other">
			<h5>对方说</h5>
			<p>你好</p>
		</div>

	</script>

	<script>
		//1-点击发送按钮，获取输入的数据， 把数据添加到在聊天窗口中
		//2-把聊天内容发送给服务器
		//3-接受服务器返回的消息，显示在页面中
		var textarea = document.querySelector('textarea');
		var messages = document.querySelector('.messages');
		document.querySelector('.btn input').onclick = function () {
			var txt = textarea.value; //获取输入的值
			//先把消息包装成一定结构，在放到messages中		
			//添加
			messages.appendChild( setMsg('self', txt) );
			//清空输入框
			textarea.value = '';

			//向服务器发送请求，让服务器随机返回一条内容
			//1-创建一个XMLHttpRequest对象
			var xhr = new XMLHttpRequest();
			//2-模拟http协议
			xhr.open('get', './chat.php');
		
			//----

			//3-监听服务器响应
			xhr.onreadystatechange = function () {
				if (xhr.readyState == 4 && xhr.status == 200) {
					var  r =xhr.responseText;
					console.log(r);
					//包装服务期返回的消息
					messages.appendChild( setMsg('other', r));
				}
			}	

		}

		//接受聊天内容，生成结构
		//flag 谁说的 'self' 'other'
		//txt  聊天内容
		function setMsg(flag, txt) {
			var div = document.createElement('div');
			var h5 = document.createElement('h5');
			var p = document.createElement('p');
			if (flag == 'self') {
				div.classList.add('self'); //添加类名
				h5.innerHTML = '我说';
			} else {
				div.classList.add('other'); //添加类名
				h5.innerHTML = '对方说';
			}	

			p.innerHTML = txt; //聊天内容
			//建立父子关系
			div.appendChild(h5);
			div.appendChild(p);
			
			return div;
		}

	</script>

	
</body>
</html>
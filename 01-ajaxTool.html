<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        //高度： 把js库可以给更多人使用, 用的时候尽可能简单，容错性强
        //原因： ajax请求服务器代码，多次反复使用，遂封装！
        //封装的目的： 提供代码复用性
        //如何封装  ： 公共代码直接提取， 把变化的部分暴露成参数 

        //变化部分 （参数）
        //1-请求方式type : get  post  
        //2-请求地址url ： 
        //3-发送给服务器的数据 data  让使用值传递对象
        //4-渲染后返回数据方式 callback

        // 还要处理get请求 和post请求差异问题
        // get 在url后面拼接数据 
        // post 在send中放数据  
        // post必须设置请求头

        //优化一： 参数优化
        //以下传参方式 要求 实参顺序必须和形参一一对应，对使用这要求高
        //解决 ：使用对象 对象是无序键值对的集合 
        // function ajax (type, url, data, callback) {
        //     callback();
        // }

        //ajax('get', '01.php', {}, function () {alert(1)});
        //ajax('get',  {},  function () {alert(1)}, '01.php');
        
        // var option = {
        //     data: {'name':'zs'},
        //     type:'get',
        //     url: '01.php',
        //     callback:function () {}
        // }

        // function  ajax (option) {
        //     console.log(option.type);
        //     option.callback();
        // }

        // ajax({
        //     callback: function (){
        //         alert(22);
        //     },
        //     url:'aaa.php',
        //     type: 'get'          
        // })

        //全局污染 定义在全局的函数和变量都会全局污染
        // 沙箱可以包含内部代码安全，不能解决外界全局污染问题
        // var ajax = 1000;  //忽略
        // (function (window) {

        //     function ajax() {

        //     }

        //     window.ajax = ajax;

        // })(window);

        //命名空间： 专门用于命名区域，可以解决全局污染问题
        //命名空间每个项目会有自己命名规范，分配命名空间 
        // var itcast = {
        //     ajax: function (){

        //     },
        //     css: function (){

        //     },
        //     background: function () {

        //     }
        // }

        // itcast.ajax();
        // itcast1.ajax();

        // var itcast1 = {
        //     ajax: function (){

        //     },
        //     css: function (){

        //     },
        // }
        // 沙箱：保护沙箱内部安全的 
        // 命名空间 ： 解决全局污染问题 （模块化）
        // js 使用对象是很方便的，拼接字符串繁琐， 字符串是最容易，并最男发现错误的
        // 数据 使用只用传递对象，转换字字符串js库内部搞定  name=zs&age=18
        // var obj = {
        //     name:'zs',
        //     age: 18
        // }
        //用对象来封装 属性 和方法
        var itcast = {
            ajax: function (option) {
                //1-参数处理
                var type = option.type || 'get'; //默认值get
                var url = option.url || location.href; //默认请求当前页面
                var callback = option.callback; //渲染数据方法
                var  data = this.setParam(option.data);  //name=zs&age=18&sex=m  但option是对象 
                
                //2-开始封装ajax的实现代码
                //2-1-创建一个XMLHttpRequest对象
                var  xhr = new XMLHttpRequest();
                
                //get请求在url后面拼接数据
                if (type == 'get') {
                    url = url + '?' + data; //aa.php?name=zs&age=18
                    data = null; 
                }
                //2-2请求行
                xhr.open(type, url);
                //2-3请求头
                if (type == 'post') {
                    xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded');
                }
                //2-4请求主体
                xhr.send(data);

                //3-监听服务器响应
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        var r = xhr.responseText;
                        //渲染数据
                        //把服务器返回的数据交给callback来渲染
                        // if(callback) {
                        //     callback(r);
                        // }
                        //如果callback存在，则执行callback
                        callback && callback(r);

                    }
                }

            },
            //专门用于将对象转成 name=zs&age=18格式 
            //obj 是对象  返回的是   name=zs&age=18 字符串
            setParam: function (obj) {
                var str = '';
                if(obj) {
                    for (var k in obj) {
                        str += k + '=' + obj[k] + '&';
                    }
                    //substr(起始索引，截取长度)
                    str= str.substr(0, str.length - 1);//去掉最后一个字符
                }
                return str;
            }
        }
        
        // var obj = {
        //     name:'zs',
        //     age: 18
        // }
        // console.log(itcast.setParam(obj));

        // itcast.ajax({
        //     data: {name: 'zs', age: 18, sex: 'm'},
        //     url: '00.php',
        //     callback:function(){}
        // })
        
        



    </script>
</body>
</html>
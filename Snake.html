<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>贪吃</title>
  <style>
    #map {
      width: 800px;
      height: 500px;
      background: #47a;
      position: relative;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script src="food.js"></script>
  <script src="snake.js"></script>
  <script>
    // 1定义一个map 限定蛇的活动范围
    var map = document.getElementById('map');
   
    // var snake = new Snake();  //创建实例对象
    // snake.render(map); //调用渲染 让蛇出现在页面中 
    
    // var food = new Food();
    // food.render(map);
    // 设置定时器 
    // setInterval(function () {
    //   snake.move(map);
    // }, 500)
    
    // 游戏对象 1.创建构造函数
    function Game(map){
      //添加食物对象
      this.food = new Food();
      //添加蛇
      this.snake = new Snake();
      //添加map地图属性
      this.map = map;
    }
    // // 2 给原型对象中添加开始游戏的方法
    Game.prototype.start = function(){
      var that = this;
      this.food.render(this.map);
      this.snake.render(this.map);
      document.addEventListener('keyup',function(event){
        switch (event.keyCode) {
          case 37:
          if (that.snake.direction === 'right') {
              return
            }
          that.snake.direction = 'left';
          break;
          case 38:
          if (that.snake.direction === 'down') {
              return
            }
          that.snake.direction = 'up';
          break;
          case 39:
          if (that.snake.direction === 'left') {
              return
            }
          that.snake.direction = 'right';
          break;
          case 40:
          if (that.snake.direction === 'up') {
              return
            }
          that.snake.direction = 'down';
          break;
        }
      })
    //   //3.让蛇动起来
     
    //   //4 蛇吃食物的逻辑--应该放到蛇对象的move方法中来实现

    //   // 5 蛇撞墙后 游戏结束
    // }
    var timerId = setInterval(function(){
      that.snake.move(this.map,this.food)
      var head = that.snake.body[0];
      if (head.x < 0 || head.y < 0 || head.x > ((that.map.offsetWidth / that.snake.width) - 1) || head.y > ((that.map.offsetHeight / that.snake.height) - 1)) {
        alert('Game over')
        clearInterval(timerId)
        
      }
      //判断自己吃自己
      for (var i = 4; i < that.snake.body.length;i++){
        //判断蛇头有没有与蛇节重合 如果重合了 说明吃到自己了 游戏结束
         if (head.x === that.snake.body[i].x && head.y === that.snake.body[i].y) {
           alert('Game Over,自己吃自己')
           clearInterval(timerId)
         }
      }
     },200)
    }
    // //创建游戏对象的时候 指定地图
    var g = new Game(map)
    // //调用该方法 让游戏开始
    g.start()
  </script>
</body>

</html>